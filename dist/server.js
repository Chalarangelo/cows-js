"use strict";function _interopDefault(a){return a&&"object"==typeof a&&"default"in a?a["default"]:a}var yargs=_interopDefault(require("yargs")),readline=_interopDefault(require("readline")),process$1=_interopDefault(require("process")),chalk=_interopDefault(require("chalk")),http=_interopDefault(require("http")),path=_interopDefault(require("path")),express=_interopDefault(require("express")),ws=_interopDefault(require("ws")),options=yargs.option("port",{alias:"p",describe:"The port that the application will run on.",default:5e3,number:"number"}).option("cleanup",{alias:"c",describe:"Cleanup all data files after the server finishes running.",default:!0,type:"boolean"}),args=options,rl=readline.createInterface({input:process.stdin,output:process.stdout});rl.on("line",function(a){"exit"===a.trim()&&process.exit(0)});var exitHandler=function(a){var b=function(b){return function(c){a.cleanup&&console.log(chalk.yellow("Cleaning up data files...")),"uncaughtException"===b?(console.log(chalk.red("Exiting due to an uncaughtException...")),console.log(chalk.red(c)),process$1.exit(1)):(console.log(chalk.yellow("Exiting normally or due to user termination...")),process$1.exit(0))}};["exit","SIGINT","SIGUSR1","SIGUSR2","uncaughtException","SIGTERM"].forEach(function(a){process$1.on(a,b(a))})},exitHandler_1=exitHandler,argv=args.argv,exitHandler$1=exitHandler_1(argv),app=express();app.use(express.static(path.join(__dirname,"public")));var server=http.createServer(app),socketServer=new ws.Server({server:server});socketServer.on("connection",function(a,b){console.log(chalk.cyan("Established connection with client on the following IP address: ".concat(b.connection.remoteAddress,"."))),a.send("Hello there, I am the server!"),a.on("message",function(a){socketServer.clients.forEach(function(c){c.send("".concat(b.connection.remoteAddress,": ").concat(a))})})}),server.listen(argv.port,function(){console.log(chalk.green("Server started.")),console.log(chalk.green("Listening on port ".concat(argv.port,"...")))});var server_1={};module.exports=server_1;
